@{
    ViewData["Title"] = "Venue Details";
}

<div class="shadow p-3 my-3 rounded">
    <h2>Examiner Recruitment Venue Details</h2>

    <div class="row">
 
        <div class="col-12 col-md-9">
        </div>
        <div class="col-12 col-md-3">
            <a class="btn btn-outline-primary text-end" asp-action="Create" asp-controller="ExaminerRecruitmentVenueDetails">Add Venue</a>
        </div>
    </div>
</div>

<table id="venueTable" class="table table-striped table-responsive table-bordered">
    <thead>
        <tr>
            <th>Venue Name</th>
            <th>Training Start Date</th>
            <th>Training End Date</th>
            <th>Check In Date</th>
            <th>Check Out Date</th>
            <th>Training Time</th>
            <th>Actions</th> <!-- Add this -->
        </tr>
    </thead>
</table>

<script>
    $(document).ready(function () {
        // Initialize DataTable
        $('#venueTable').DataTable({
            "processing": true,
            "serverSide": true,
            "ajax": {
                "url": "/ExaminerRecruitmentVenueDetails/GetVenueDetails",
                "type": "POST"
            },
            "columns": [
                { "data": "venueName" },
                {
                    "data": "trainingStartDate",
                    "render": function (data) { return formatDate(data); }
                },
                {
                    "data": "trainingEndDate",
                    "render": function (data) { return formatDate(data); }
                },
                {
                    "data": "checkInDate",
                    "render": function (data) { return formatDate(data); }
                },
                {
                    "data": "checkOutDate",
                    "render": function (data) { return data ? formatDate(data) : ""; }
                },
                { "data": "trainingTime" },
                {
                    "data": "id",
                    "render": function (data, type, row) {
                        return `
                                <div class="btn-group">
                                    <a href="/ExaminerRecruitmentVenueDetails/Edit/${data}" class="btn btn-sm btn-primary" title="Edit">
                                        <i class="bi bi-pencil-square"></i>
                                    </a>
                                    <button class="btn btn-sm btn-danger" onclick="deleteVenue(${data})" title="Delete">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            `;
                    },
                    "orderable": false
                }
            ]
        });

        // SweetAlert success message from TempData
        var successMessage = '@TempData["SuccessMessage"]';
        if (successMessage) {
            Swal.fire({
                icon: 'success',
                title: 'Success!',
                text: successMessage,
                timer: 1500,
                showConfirmButton: false
            });
        }
    });

    // Date formatting function
    function formatDate(dateString) {
        if (!dateString) return "";
        let date = new Date(dateString);
        return date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate();
    }

    // SweetAlert delete function
    function deleteVenue(id) {
        Swal.fire({
            title: "Are you sure?",
            text: "You won’t be able to undo this action!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#d33",
            cancelButtonColor: "#3085d6",
            confirmButtonText: "Yes, delete it!"
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: `/ExaminerRecruitmentVenueDetails/Delete/${id}`,
                    type: "POST",
                    success: function (response) {
                        Swal.fire({
                            title: "Deleted!",
                            text: "The venue has been deleted.",
                            icon: "success",
                            showConfirmButton: false,
                            timer: 1500
                        });
                        $('#venueTable').DataTable().ajax.reload();
                    },
                    error: function () {
                        Swal.fire("Error!", "There was an issue deleting the venue.", "error");
                    }
                });
            }
        });
    }
</script>


